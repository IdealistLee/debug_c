import csv
import ast

def process_csv(input_file, output_file):
    """处理CSV文件，根据C列元素的elemset:内容去重"""
    with open(input_file, 'r', encoding='utf-8') as f_in, \
         open(output_file, 'w', newline='', encoding='utf-8') as f_out:
        
        reader = csv.reader(f_in)
        writer = csv.writer(f_out)
        
        # 写入表头
        writer.writerow(next(reader))
        
        for row in reader:
            if len(row) < 3:
                writer.writerow(row)
                continue
            
            c_value = row[2].strip()
            
            if not c_value or c_value == '[]':
                row[2] = ""
                writer.writerow(row)
                continue
            
            try:
                # 解析列表
                items = ast.literal_eval(c_value)
                if not isinstance(items, list):
                    items = [items]
                
                # 根据elemset内容去重
                seen = set()
                unique_items = []
                
                for item in items:
                    item_str = str(item)
                    # 提取elemset:后面的内容
                    if "elemset:" in item_str:
                        key = item_str.split("elemset:", 1)[1].strip()
                    else:
                        key = item_str.strip()
                    
                    # 如果这个key还没出现过，添加原始元素
                    if key and key not in seen:
                        seen.add(key)
                        unique_items.append(item_str)
                
                # 写入结果
                if not unique_items:
                    row[2] = ""
                    writer.writerow(row)
                else:
                    for item in unique_items:
                        new_row = row.copy()
                        new_row[2] = item
                        writer.writerow(new_row)
                        
            except:
                # 解析失败，原样写入
                writer.writerow(row)
    
    print(f"处理完成: {output_file}")

# 使用
process_csv("input.csv", "output.csv")
